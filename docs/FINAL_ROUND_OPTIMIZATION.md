# æœ€åä¸€è½®ä¼˜åŒ–ç­–ç•¥è¯´æ˜

## é—®é¢˜èƒŒæ™¯

åœ¨å—ç“œæŒ‘æˆ˜ä¸­ï¼Œç›®æ ‡æ˜¯è¾¾åˆ° 200M å—ç“œã€‚ä½†åœ¨æœ€åä¸€è½®ï¼Œä¸éœ€è¦æ‰€æœ‰æ— äººæœºéƒ½ç§æ¤è‡ªå·±çš„åŒºåŸŸï¼Œå› ä¸ºï¼š
1. æ€»äº§é‡å·²ç»æ¥è¿‘ç›®æ ‡ï¼ˆ195Mï¼‰
2. å®Œæˆå¿«çš„æ— äººæœºå¯ä»¥å¸®åŠ©æ…¢çš„åŒºåŸŸ
3. å‡å°‘æ— äººæœºç­‰å¾…æ—¶é—´ï¼Œæé«˜æ•´ä½“æ•ˆç‡

## ä¼˜åŒ–æ–¹æ¡ˆ

### æ ¸å¿ƒæ€è·¯

**åˆ†é˜¶æ®µç­–ç•¥**ï¼š
- **æ­£å¸¸é˜¶æ®µ**ï¼ˆ0-195Mï¼‰ï¼šæ¯ä¸ªæ— äººæœºè´Ÿè´£è‡ªå·±çš„ 6x6 åŒºåŸŸ
- **æœ€åä¸€è½®**ï¼ˆ195M-200Mï¼‰ï¼šå®Œæˆçš„æ— äººæœºè½¬ä¸º"å¸®æ‰‹æ¨¡å¼"ï¼ŒååŠ©å…¶ä»–åŒºåŸŸ

### å…³é”®æœºåˆ¶

#### 1. é˜ˆå€¼è§¦å‘æœºåˆ¶
```python
FINAL_ROUND_THRESHOLD = 195000000  # 195M è§¦å‘æœ€åä¸€è½®
TARGET = 200000000  # 200M ç›®æ ‡
```

å½“ä»»æ„æ— äººæœºæ£€æµ‹åˆ°å—ç“œæ•°é‡è¾¾åˆ° 195M æ—¶ï¼š
- è®¾ç½®å…¨å±€æ ‡å¿— `shared["final_round"] = True`
- æ‰€æœ‰æ— äººæœºè¿›å…¥æœ€åä¸€è½®æ¨¡å¼

#### 2. å…¨å±€ä»»åŠ¡æ± ï¼ˆGlobal Task Poolï¼‰
```python
shared = {
    "global_task_pool": [],  # [(x, y, region_x, region_y), ...]
    "final_round": False,
    "completed_drones": 0,
}
```

**ä»»åŠ¡æ± ä½œç”¨**ï¼š
- æ”¶é›†æ‰€æœ‰æœªæˆç†Ÿçš„å—ç“œä½ç½®
- ä¾›ç©ºé—²æ— äººæœºè®¤é¢†å’Œå¤„ç†
- ä½¿ç”¨"æœ€è¿‘ä»»åŠ¡ä¼˜å…ˆ"ç­–ç•¥

#### 3. æ— äººæœºæ¨¡å¼åˆ‡æ¢

**æ­£å¸¸æ¨¡å¼**ï¼š
1. ç§æ¤è‡ªå·±åŒºåŸŸçš„ 18 ä¸ªä½ç½®
2. æ‰«ææœªæˆç†Ÿå—ç“œ
3. éªŒè¯å’Œè¡¥ç§ï¼ˆæœ¬åœ°å¤„ç†ï¼‰
4. æ”¶è·

**æœ€åä¸€è½®æ¨¡å¼è§¦å‘æ¡ä»¶**ï¼ˆå½“ `pumpkin_count >= 195M`ï¼‰ï¼š
- âœ… è®¾ç½®å…¨å±€æ ‡å¿— `shared["final_round"] = True`
- âš ï¸ **ä½†ä¸å½±å“å½“å‰è½®æ¬¡çš„æ­£å¸¸æµç¨‹**

**æœ€åä¸€è½®å®Œæ•´æµç¨‹**ï¼š
1. âœ… ç§æ¤è‡ªå·±åŒºåŸŸï¼ˆæ­£å¸¸æ‰§è¡Œï¼‰
2. âœ… æ‰«ææœªæˆç†Ÿå—ç“œï¼ˆæ­£å¸¸æ‰§è¡Œï¼‰
3. âœ… éªŒè¯å’Œè¡¥ç§ï¼ˆæ­£å¸¸æ‰§è¡Œï¼Œä¸è·³è¿‡ï¼‰
4. âœ… æ”¶è·ï¼ˆæ­£å¸¸æ‰§è¡Œï¼‰
5. ğŸ”„ **æ”¶è·å®Œæˆå**æ£€æŸ¥ï¼šå¦‚æœ `final_round=True` ä¸” `pumpkin_count >= 195M`ï¼Œè½¬ä¸º"å¸®æ‰‹æ¨¡å¼"

**å…³é”®è®¾è®¡åŸåˆ™**ï¼š
- âš ï¸ **ç»ä¸åœ¨å®Œæˆæ”¶è·å‰æå‰é€€å‡ºæˆ–è·³è¿‡ä»»ä½•æ­¥éª¤**
- âœ… åªåœ¨æ”¶è·å®Œæˆåæ‰åˆ¤æ–­æ˜¯å¦è½¬ä¸ºå¸®æ‰‹æ¨¡å¼
- âœ… ç¡®ä¿æ¯ä¸ªæ— äººæœºéƒ½å®Œæ•´å®Œæˆè‡ªå·±åŒºåŸŸçš„å½“å‰è½®æ¬¡

**å¸®æ‰‹æ¨¡å¼**ï¼ˆ`final_round_helper`ï¼‰ï¼š
```python
while True:
    if pumpkin_count >= TARGET:
        return  # è¾¾æ ‡ï¼Œé€€å‡º
    
    # 1. ä»ä»»åŠ¡æ± è·å–æœ€è¿‘çš„ä»»åŠ¡
    task = get_nearest_task(shared, current_x, current_y)
    
    # 2. å¤„ç†ä»»åŠ¡
    if task:
        process_task(task_x, task_y)
    else:
        # 3. æ²¡æœ‰ä»»åŠ¡ï¼Œå¸®å¿™éªŒè¯å…¶ä»–åŒºåŸŸ
        help_other_regions()
```

### ç®—æ³•è¯¦è§£

#### æ‰§è¡Œæ—¶æœºï¼ˆé‡è¦ï¼ï¼‰

```python
# worker_left çš„æ‰§è¡Œæµç¨‹
while True:
    # é˜¶æ®µ1ï¼šç§æ¤ï¼ˆæ­£å¸¸æ‰§è¡Œï¼‰
    plant_all()
    
    # é˜¶æ®µ2ï¼šæ‰«æï¼ˆæ­£å¸¸æ‰§è¡Œï¼‰
    scan_unverified()
    
    # å¯èƒ½è§¦å‘æœ€åä¸€è½®æ ‡å¿—
    if pumpkin_count >= 195M:
        shared["final_round"] = True
    
    # é˜¶æ®µ3ï¼šéªŒè¯å’Œè¡¥ç§ï¼ˆæ­£å¸¸æ‰§è¡Œï¼Œä¸è·³è¿‡ï¼ï¼‰
    verify_and_replant()  # å³ä½¿ final_round=True ä¹Ÿè¦å®Œæˆ
    
    # é˜¶æ®µ4ï¼šæ”¶è·ï¼ˆæ­£å¸¸æ‰§è¡Œï¼‰
    harvest()
    
    # â­ å…³é”®æ£€æŸ¥ç‚¹ï¼šæ”¶è·å®Œæˆå
    if pumpkin_count >= TARGET:
        return  # è¾¾æ ‡é€€å‡º
    
    if shared["final_round"] and pumpkin_count >= 195M:
        # è½¬ä¸ºå¸®æ‰‹æ¨¡å¼
        final_round_helper()
        return
    
    # å¦åˆ™ç»§ç»­ä¸‹ä¸€è½®
```

**ä¸ºä»€ä¹ˆå¿…é¡»å®Œæˆå½“å‰è½®æ¬¡ï¼Ÿ**
1. **ä¿è¯äº§é‡**ï¼šè·³è¿‡éªŒè¯ä¼šå¯¼è‡´è¯¥è½®æ¬¡äº§é‡é™ä½
2. **é¿å…æµªè´¹**ï¼šå·²ç§æ¤çš„å—ç“œå¿…é¡»æ”¶è·æ‰èƒ½è®¡å…¥æ€»æ•°
3. **åŒæ­¥é—®é¢˜**ï¼šå·¦å³æ— äººæœºéœ€è¦åŒæ­¥ï¼Œæå‰é€€å‡ºä¼šç ´ååŒæ­¥
4. **æ•ˆç‡æœ€ä¼˜**ï¼šå®Œæˆå½“å‰è½®æ¬¡æ¯”ç•™ä¸‹æœªå®Œæˆä»»åŠ¡æ›´é«˜æ•ˆ

#### æœ€è¿‘ä»»åŠ¡é€‰æ‹©ç®—æ³•ï¼ˆManhattan Distanceï¼‰

```python
def get_nearest_task(shared, current_x, current_y):
    task_pool = shared["global_task_pool"]
    best_distance = 999999
    
    for task in task_pool:
        task_x, task_y, _, _ = task
        distance = manhattan_distance(current_x, current_y, task_x, task_y)
        if distance < best_distance:
            best_distance = distance
            best_task = task
    
    # ç§»é™¤å¹¶è¿”å›æœ€è¿‘çš„ä»»åŠ¡
    task_pool.remove(best_task)
    return best_task
```

**ä¸ºä»€ä¹ˆç”¨æ›¼å“ˆé¡¿è·ç¦»ï¼Ÿ**
- æ¸¸æˆä¸­ç§»åŠ¨æ˜¯æŒ‰æ–¹å‘ï¼ˆä¸Šä¸‹å·¦å³ï¼‰è¿›è¡Œçš„
- æ›¼å“ˆé¡¿è·ç¦» = |dx| + |dy| å‡†ç¡®åæ˜ ç§»åŠ¨æˆæœ¬
- è€ƒè™‘ç¯å½¢åœ°å›¾ï¼š`dx = min(abs(x2-x1), 32-abs(x2-x1))`

#### ä»»åŠ¡å¤„ç†æµç¨‹

```python
def process_task(task_x, task_y):
    goto(task_x, task_y)
    entity = get_entity_type()
    
    if entity == Entities.Pumpkin:
        if not can_harvest():
            # æµ‡æ°´ â†’ æ–½è‚¥ â†’ éªŒè¯
            if get_water() < THRESHOLD:
                use_item(Items.Water)
            while not can_harvest():
                use_item(Items.Fertilizer)
            # å¦‚æœè¿˜æ˜¯æœªæˆç†Ÿï¼Œè¡¥ç§
            if not can_harvest():
                plant(Entities.Pumpkin)
                use_water_and_fertilizer()
                return False  # ä»»åŠ¡å¤±è´¥ï¼Œéœ€è¦é‡æ–°åŠ å…¥ä»»åŠ¡æ± 
    
    elif entity == Entities.Dead_Pumpkin:
        plant(Entities.Pumpkin)
        use_water_and_fertilizer()
        return False  # éœ€è¦é‡æ–°å¤„ç†
    
    return True  # ä»»åŠ¡å®Œæˆ
```

### ä¼˜åŒ–æ•ˆæœé¢„ä¼°

#### æ—¶é—´èŠ‚çœåˆ†æ

**å‡è®¾åœºæ™¯**ï¼š
- 16 ä¸ªåŒºåŸŸï¼Œ32 ä¸ªæ— äººæœº
- æœ€åä¸€è½®æœ‰ 10% çš„å—ç“œæœªæˆç†Ÿï¼ˆçº¦ 160 ä¸ªä½ç½®ï¼‰
- å¹³å‡æ¯ä¸ªä½ç½®éœ€è¦ 2 ä¸ªéªŒè¯å‘¨æœŸ

**ä¼ ç»Ÿæ–¹å¼**ï¼ˆæ¯ä¸ªæ— äººæœºå¤„ç†è‡ªå·±åŒºåŸŸï¼‰ï¼š
- æ¯ä¸ªåŒºåŸŸçº¦æœ‰ 10 ä¸ªæœªæˆç†Ÿå—ç“œ
- æœ€æ…¢çš„åŒºåŸŸå¯èƒ½æœ‰ 15 ä¸ª
- æœ€å¿«å®Œæˆæ—¶é—´ï¼š10 Ã— 2 Ã— 500 ticks = 10,000 ticks
- æœ€æ…¢å®Œæˆæ—¶é—´ï¼š15 Ã— 2 Ã— 500 ticks = 15,000 ticks
- **æ€»æ—¶é—´ = æœ€æ…¢çš„é‚£ä¸ª = 15,000 ticks**

**ä¼˜åŒ–æ–¹å¼**ï¼ˆä»»åŠ¡æ± åä½œï¼‰ï¼š
- å®Œæˆå¿«çš„æ— äººæœºï¼ˆ16 ä¸ªï¼‰ç«‹å³å¸®å¿™
- 160 ä¸ªä»»åŠ¡ç”± 32 ä¸ªæ— äººæœºå…±åŒå¤„ç†
- å¹³å‡æ¯ä¸ªæ— äººæœºï¼š160 / 32 = 5 ä¸ªä»»åŠ¡
- **æ€»æ—¶é—´ â‰ˆ 5 Ã— 2 Ã— 500 ticks = 5,000 ticks**

**æ—¶é—´èŠ‚çœï¼š15,000 - 5,000 = 10,000 ticksï¼ˆçº¦ 66% æå‡ï¼‰**

### ç«æ€æ¡ä»¶å¤„ç†

#### é—®é¢˜ï¼šå¤šä¸ªæ— äººæœºåŒæ—¶è®¿é—®ä»»åŠ¡æ± 

**è§£å†³æ–¹æ¡ˆ 1ï¼šåŸå­æ“ä½œ**
```python
# ä½¿ç”¨ pop() è€Œä¸æ˜¯ remove()
task = task_pool.pop(best_index)  # åŸå­æ“ä½œï¼Œçº¿ç¨‹å®‰å…¨
```

**è§£å†³æ–¹æ¡ˆ 2ï¼šä»»åŠ¡å¤±è´¥é‡è¯•**
```python
if not process_task(task):
    # ä»»åŠ¡å¤±è´¥ï¼Œé‡æ–°åŠ å…¥ä»»åŠ¡æ± 
    shared["global_task_pool"].append(task)
```

**è§£å†³æ–¹æ¡ˆ 3ï¼šä»»åŠ¡éªŒè¯**
```python
# å¤„ç†ä»»åŠ¡å‰å…ˆæ£€æŸ¥
goto(task_x, task_y)
if can_harvest():
    return True  # å·²è¢«å…¶ä»–æ— äººæœºå¤„ç†ï¼Œè·³è¿‡
```

### è¾¹ç•Œæƒ…å†µå¤„ç†

#### 1. ä»»åŠ¡æ± ä¸ºç©º
```python
if not task:
    # å°è¯•å¸®å¿™éªŒè¯å…¶ä»–åŒºåŸŸçš„ unverified åˆ—è¡¨
    for region in all_regions:
        if region["unverified_left"]:
            help(region, "unverified_left")
            break
    else:
        # çœŸçš„æ²¡äº‹åšäº†ï¼Œç­‰å¾…æˆ–å¿«è¿›
        do_a_flip()
```

#### 2. æå‰è¾¾æ ‡
```python
# åœ¨æ¯ä¸ªå…³é”®ç‚¹æ£€æŸ¥
pumpkin_count = num_items(Items.Pumpkin)
if pumpkin_count >= TARGET:
    clear()  # æ¸…ç†åœºåœ°
    return  # é€€å‡º
```

#### 3. é˜ˆå€¼è°ƒæ•´
```python
# å¦‚æœ 195M å¤ªæ™šï¼Œå¯ä»¥é™ä½åˆ° 190M
# å¦‚æœ 195M å¤ªæ—©ï¼Œå¯ä»¥æé«˜åˆ° 197M
# éœ€è¦æ ¹æ®å®é™…æµ‹è¯•è°ƒæ•´
FINAL_ROUND_THRESHOLD = 195000000
```

## ä½¿ç”¨æ–¹æ³•

### 1. ç›´æ¥è¿è¡Œ
```python
# åœ¨æ¸¸æˆä¸­è¿è¡Œ pumpkin_v4.py
# è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åˆ‡æ¢åˆ°æœ€åä¸€è½®æ¨¡å¼
```

### 2. ç›‘æ§æ—¥å¿—
```python
# å…³é”®æ—¥å¿—è¾“å‡ºï¼š
# [FINAL_ROUND] Activated at 195123456 pumpkins
# [worker_left] 7 19 Entering helper mode at 195234567
# [final_round_helper] Drone at region 7 19 entering helper mode
```

### 3. è°ƒæ•´å‚æ•°
```python
# åœ¨æ–‡ä»¶å¼€å¤´ä¿®æ”¹ï¼š
FINAL_ROUND_THRESHOLD = 190000000  # æ›´æ—©è¿›å…¥ï¼ˆæ›´ä¿å®ˆï¼‰
FINAL_ROUND_THRESHOLD = 197000000  # æ›´æ™šè¿›å…¥ï¼ˆæ›´æ¿€è¿›ï¼‰
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. é˜ˆå€¼é€‰æ‹©
- **å¤ªä½ï¼ˆå¦‚ 180Mï¼‰**ï¼šæµªè´¹æ­£å¸¸é˜¶æ®µçš„å¹¶è¡Œæ€§
- **å¤ªé«˜ï¼ˆå¦‚ 198Mï¼‰**ï¼šæ¥ä¸åŠåä½œï¼Œæ•ˆæœä¸æ˜æ˜¾
- **æ¨èï¼š195M**ï¼ˆè¿˜å‰© 5Mï¼Œçº¦ 2.5%ï¼Œè¶³å¤Ÿåä½œä½†ä¸æµªè´¹ï¼‰

### 2. ä»»åŠ¡æ± ç­–ç•¥
- âœ… **æœ€è¿‘ä»»åŠ¡ä¼˜å…ˆ**ï¼šå‡å°‘ç§»åŠ¨æˆæœ¬
- âŒ **å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰**ï¼šå¯èƒ½å¯¼è‡´é•¿è·ç¦»ç§»åŠ¨
- âŒ **éšæœºé€‰æ‹©**ï¼šæ•ˆç‡ä¸ç¨³å®š

### 3. å¸®æ‰‹æ¨¡å¼è§¦å‘æ—¶æœº
```python
# å½“å‰å®ç°ï¼šå®Œæˆè‡ªå·±åŒºåŸŸåç«‹å³è½¬ä¸ºå¸®æ‰‹
if shared["final_round"] and pumpkin_count >= FINAL_ROUND_THRESHOLD:
    final_round_helper()

# å¯é€‰å®ç°ï¼šåªæœ‰å¿«çš„æ— äººæœºæ‰å¸®å¿™ï¼ˆå‰ 50%ï¼‰
if shared["final_round"] and shared["completed_drones"] < 16:
    final_round_helper()
```

## é¢„æœŸæ•ˆæœ

### åœºæ™¯ 1ï¼šå‡è¡¡åˆ†å¸ƒ
- æ‰€æœ‰åŒºåŸŸåŒæ—¶å®Œæˆ
- æ•ˆæœï¼š**æå‡ 30-40%**ï¼ˆå‡å°‘æœ€åçš„ç­‰å¾…æ—¶é—´ï¼‰

### åœºæ™¯ 2ï¼šä¸å‡è¡¡åˆ†å¸ƒ
- éƒ¨åˆ†åŒºåŸŸæœ‰å¤§é‡æ¯èå—ç“œ
- æ•ˆæœï¼š**æå‡ 50-70%**ï¼ˆå¿«çš„å¸®åŠ©æ…¢çš„ï¼‰

### åœºæ™¯ 3ï¼šæç«¯ä¸å‡è¡¡
- ä¸ªåˆ«åŒºåŸŸä¸¥é‡è½å
- æ•ˆæœï¼š**æå‡ 70-90%**ï¼ˆé›†ä¸­ç«åŠ›æ”»åšï¼‰

## åç»­ä¼˜åŒ–æ–¹å‘

### 1. åŠ¨æ€é˜ˆå€¼
```python
# æ ¹æ®æœªæˆç†Ÿå—ç“œæ•°é‡åŠ¨æ€è°ƒæ•´
unverified_count = count_all_unverified()
if unverified_count < 50:
    THRESHOLD = 198000000  # å¾ˆå°‘ï¼Œå¯ä»¥æ™šä¸€ç‚¹
else:
    THRESHOLD = 195000000  # å¾ˆå¤šï¼Œæ—©ç‚¹å¼€å§‹
```

### 2. ä»»åŠ¡ä¼˜å…ˆçº§
```python
# ç»™ä»»åŠ¡æ·»åŠ ä¼˜å…ˆçº§
# ä¼˜å…ˆå¤„ç†å¤šæ¬¡å¤±è´¥çš„ä»»åŠ¡
task = {
    "x": x, "y": y,
    "retry_count": 0,
    "priority": 0
}
```

### 3. åŒºåŸŸè´Ÿè½½å‡è¡¡
```python
# è®°å½•æ¯ä¸ªåŒºåŸŸçš„å·¥ä½œè´Ÿè½½
# ä¼˜å…ˆå¸®åŠ©è´Ÿè½½æœ€é‡çš„åŒºåŸŸ
region_load = {
    (0, 7): len(region["unverified_left"]) + len(region["unverified_right"])
}
```

## æ³¨æ„äº‹é¡¹

1. **å…±äº«å†…å­˜å®‰å…¨**ï¼š
   - ä½¿ç”¨ `pop()` è€Œä¸æ˜¯ `remove()` æ¥é¿å…ç«æ€
   - ä»»åŠ¡å¤±è´¥æ—¶é‡æ–°åŠ å…¥ä»»åŠ¡æ± 

2. **æ€§èƒ½ç›‘æ§**ï¼š
   - ä½¿ç”¨ `quick_print()` è®°å½•å…³é”®æ—¶é—´ç‚¹
   - æ¯”è¾ƒä¼˜åŒ–å‰åçš„æ€»æ—¶é—´

3. **é˜ˆå€¼è°ƒè¯•**ï¼š
   - é¦–æ¬¡è¿è¡Œå»ºè®®ç”¨ 195M
   - æ ¹æ®æ—¥å¿—è°ƒæ•´ï¼ˆå¤ªæ—©/å¤ªæ™šï¼‰

4. **è¾¹ç•Œæ¡ä»¶**ï¼š
   - æ£€æŸ¥ä»»åŠ¡æ± æ˜¯å¦ä¸ºç©º
   - æ£€æŸ¥æ˜¯å¦æå‰è¾¾æ ‡
   - å¤„ç†æ¯èå—ç“œçš„ç‰¹æ®Šæƒ…å†µ

## æ€»ç»“

è¿™ä¸ªä¼˜åŒ–æ–¹æ¡ˆé€šè¿‡"æœ€åä¸€è½®åä½œæœºåˆ¶"ï¼Œå°†æ— äººæœºä»å›ºå®šåŒºåŸŸæ¨¡å¼è½¬æ¢ä¸ºåŠ¨æ€ä»»åŠ¡æ± æ¨¡å¼ï¼Œæ˜¾è‘—æé«˜äº†æ•´ä½“æ•ˆç‡ã€‚æ ¸å¿ƒä¼˜åŠ¿æ˜¯ï¼š

1. âœ… **é›¶æµªè´¹**ï¼šå®Œæˆå¿«çš„æ— äººæœºä¸å†ç­‰å¾…
2. âœ… **å°±è¿‘å¸®å¿™**ï¼šå‡å°‘ç§»åŠ¨æˆæœ¬
3. âœ… **åŠ¨æ€å¹³è¡¡**ï¼šè‡ªåŠ¨å¤„ç†ä¸å‡è¡¡æƒ…å†µ
4. âœ… **æå‰è¾¾æ ‡**ï¼šé¢„è®¡èŠ‚çœ 10,000-15,000 ticks

é¢„æœŸæ€»æ—¶é—´ä» ~30 ç§’é™ä½åˆ° ~25 ç§’ï¼Œæå‡çº¦ **15-20%**ã€‚

