# Pumpkin V6 农场布局说明

## 概述
32x32 农场布局：
- **12个 7x7 区域**（每个分成 4列×7行 左半区 + 3列×7行 右半区）
- **4个 8x8 区域**

总覆盖：12×(4×7 + 3×7) + 4×(8×8) = 12×49 + 4×64 = 588 + 256 = 844 格子

## 7x7 区域布局（12个）

每个7x7区域分为：
- **左半区**：4列×7行 = 28 格子
- **右半区**：3列×7行 = 21 格子
- **总计**：7×7 = 49 格子

**重要**：左右两半区是相邻的，合并成一个完整的 7×7 正方形后才能收获。

### 路径定义

**左半区（4列×7行）路径：蛇形遍历**
```
PATH_4X7 = {
    行0: (0,0)→East→(1,0)→East→(2,0)→East→(3,0)→North
    行1: (3,1)→West→(2,1)→West→(1,1)→West→(0,1)→North
    行2: (0,2)→East→(1,2)→East→(2,2)→East→(3,2)→North
    行3: (3,3)→West→(2,3)→West→(1,3)→West→(0,3)→North
    行4: (0,4)→East→(1,4)→East→(2,4)→East→(3,4)→North
    行5: (3,5)→West→(2,5)→West→(1,5)→West→(0,5)→North
    行6: (0,6)→East→(1,6)→East→(2,6)→East→(3,6)→South
}
```

可视化（4列×7行）：
```
(0,6) → (1,6) → (2,6) → (3,6)
  ↑                       ↓
(0,5) ← (1,5) ← (2,5) ← (3,5)
  ↑                       ↓
(0,4) → (1,4) → (2,4) → (3,4)
  ↑                       ↓
(0,3) ← (1,3) ← (2,3) ← (3,3)
  ↑                       ↓
(0,2) → (1,2) → (2,2) → (3,2)
  ↑                       ↓
(0,1) ← (1,1) ← (2,1) ← (3,1)
  ↑                       ↓
起点(0,0)→(1,0)→(2,0)→(3,0)
```

**右半区（3列×7行）路径：蛇形遍历**
```
PATH_3X7 = {
    行0: (0,0)→East→(1,0)→East→(2,0)→North
    行1: (2,1)→West→(1,1)→West→(0,1)→North
    行2: (0,2)→East→(1,2)→East→(2,2)→North
    行3: (2,3)→West→(1,3)→West→(0,3)→North
    行4: (0,4)→East→(1,4)→East→(2,4)→North
    行5: (2,5)→West→(1,5)→West→(0,5)→North
    行6: (0,6)→East→(1,6)→East→(2,6)→South
}
```

可视化（3列×7行）：
```
(0,6) → (1,6) → (2,6)
  ↑               ↓
(0,5) ← (1,5) ← (2,5)
  ↑               ↓
(0,4) → (1,4) → (2,4)
  ↑               ↓
(0,3) ← (1,3) ← (2,3)
  ↑               ↓
(0,2) → (1,2) → (2,2)
  ↑               ↓
(0,1) ← (1,1) ← (2,1)
  ↑               ↓
起点(0,0)→(1,0)→(2,0)
```

### 7x7 区域坐标列表

| 序号 | 左下角坐标 | 左半区起点 | 右半区起点 | Worker |
|------|-----------|-----------|-----------|---------|
| 1  | (0, 0)   | (0, 0)    | (4, 0)    | 主无人机 |
| 2  | (8, 0)   | (8, 0)    | (12, 0)   | worker1 |
| 3  | (16, 0)  | (16, 0)   | (20, 0)   | worker2 |
| 4  | (0, 8)   | (0, 8)    | (4, 8)    | worker3 |
| 5  | (0, 16)  | (0, 16)   | (4, 16)   | worker4 |
| 6  | (25, 9)  | (25, 9)   | (29, 9)   | worker5 |
| 7  | (24, 17) | (24, 17)  | (28, 17)  | worker6 |
| 8  | (25, 25) | (25, 25)  | (29, 25)  | worker7 |
| 9  | (17, 17) | (17, 17)  | (21, 17)  | worker8 |
| 10 | (25, 17) | (25, 17)  | (29, 17)  | worker9 |
| 11 | (9, 25)  | (9, 25)   | (13, 25)  | worker10 |
| 12 | (0, 24)  | (0, 24)   | (4, 24)   | worker11 |

## 8x8 区域布局（4个）

每个8x8区域：
- **左半区**：4列（x偏移0-3）
- **右半区**：4列（x偏移4-7）
- **总计**：64 格子

### 8x8 区域坐标列表

| 序号 | 左下角坐标 | 左半区起点 | 右半区起点 | Worker |
|------|-----------|-----------|-----------|---------|
| 1  | (8, 8)   | (8, 8)    | (12, 8)   | worker15 |
| 2  | (8, 16)  | (8, 16)   | (12, 16)  | worker12 |
| 3  | (16, 8)  | (16, 8)   | (20, 8)   | worker13 |
| 4  | (24, 0)  | (24, 0)   | (28, 0)   | worker14 |

## 农场可视化（32x32）

```
0         8        16        24       31
+--------+--------+--------+--------+
|7x7(1)  |7x7(2)  |7x7(3)  |8x8(4)  | 0-7
+--------+--------+--------+--------+
|7x7(4)  |8x8(1)  |8x8(3)  |        | 8-15
+--------+--------+--------+--------+
|7x7(5)  |8x8(2)  |7x7(9)  |7x7(7)  | 16-23
+--------+--------+--------+--------+
|7x7(12) |7x7(11) |7x7(10) |7x7(8)  | 24-31
+--------+--------+--------+--------+

注：部分区域（如7x7(6)和7x7(10)）可能有重叠
```

## 双无人机协作机制

每个区域由两个无人机协作：
1. **Left Worker**：负责左半区（4x4或4列）
2. **Right Worker**：负责右半区（3x3或4列）

### 协作流程

1. **Left Worker 创建 Right Worker**
   ```python
   spawn_drone(worker)  # 创建右侧工作无人机
   ```

2. **同步种植**
   - Left: 遍历左半区种植
   - Right: 等待 Left 完成后种植右半区

3. **并行验证**
   - 两个无人机各自验证自己的半区
   - 使用肥料加速成熟
   - 处理枯萎南瓜

4. **同步收获**
   - Right Worker 先完成，设置 `ready=True`
   - Left Worker 等待 Right 完成
   - 同时收获，触发南瓜合并

5. **互助机制**
   - Right Worker 在等待时帮助 Left Worker
   - 使用 `help()` 函数处理对方的未完成格子

## 最终轮机制

当南瓜数量达到 `FINAL_ROUND_THRESHOLD`（198,500,000）时：
- 活跃无人机转为帮手模式
- 帮助其他仍在工作的区域
- 确保所有区域都能及时完成

## 性能优化

1. **路径优化**
   - 4x4 使用螺旋路径，减少移动
   - 3x3 使用蛇形路径

2. **水分管理**
   - 阈值：0.85
   - 保持高水分加速生长

3. **肥料使用**
   - 主动使用肥料缩短成熟时间
   - 循环验证直到成熟

4. **共享内存**
   - 使用 `wait_for(memory_source)` 获取共享状态
   - 实时协调多个无人机

## 配置参数

```python
WATER_THRESHOLD = 0.85        # 水分阈值
WATER_COUNT = 10              # 最小水量
FINAL_ROUND_THRESHOLD = 198500000  # 最终轮阈值
TARGET = 200000000            # 目标南瓜数量
```

## 覆盖率计算

- **7x7区域**：12个 × 49格 = 588格
- **8x8区域**：4个 × 64格 = 256格
- **总覆盖**：844格 / 1024格 = 82.4%

## 实际产量计算

### 7x7 区域产量
每个 7x7 区域是一个完整的正方形：
- **合并规则**：7×7 = 49 格子全部成熟后收获
- **收获量**：49³ = **117,649 南瓜/轮/区域**

**注意**：虽然两个无人机分别管理左半区（4列×7行）和右半区（3列×7行），但它们必须同时完成，形成完整的 7×7 正方形后才能触发南瓜合并。

### 8x8 区域产量
每个 8x8 区域分为两个独立的 4×8 区域：
- 左半区：4列×8行 = 32 格子 → 32³ = 32,768 南瓜
- 右半区：4列×8行 = 32 格子 → 32³ = 32,768 南瓜
- **总计**：65,536 南瓜/轮/区域

### 总产量
- **12个 7x7区域**：12 × 117,649 = 1,411,788 南瓜/轮
- **4个 8x8区域**：4 × 65,536 = 262,144 南瓜/轮
- **总产量/轮**：1,673,932 南瓜

### 理论轮数
目标：200,000,000 南瓜
理论轮数：200,000,000 / 1,673,932 ≈ **119.5 轮**

相比之前的设计（320,044 南瓜/轮），新设计每轮产量提升了 **5.2 倍**！

