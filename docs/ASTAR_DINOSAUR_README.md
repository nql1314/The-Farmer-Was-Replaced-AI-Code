# A* æé¾™ç®—æ³•è¯¦ç»†è¯´æ˜

## ğŸ“‹ ç›®å½•
1. [ç®—æ³•æ¦‚è¿°](#ç®—æ³•æ¦‚è¿°)
2. [æ ¸å¿ƒæ€æƒ³](#æ ¸å¿ƒæ€æƒ³)
3. [å…±äº«å†…å­˜æ¶æ„](#å…±äº«å†…å­˜æ¶æ„)
4. [A* ç®—æ³•å®ç°](#a-ç®—æ³•å®ç°)
5. [å°¾éšç­–ç•¥](#å°¾éšç­–ç•¥)
6. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
7. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)

---

## ğŸ¯ ç®—æ³•æ¦‚è¿°

**A* æœç´¢ç®—æ³•** æ˜¯è´ªåƒè›‡æ¸¸æˆä¸­æœ€å®ç”¨ã€æœ€é«˜æ•ˆçš„ç®—æ³•ä¹‹ä¸€ã€‚å®ƒåœ¨"å®‰å…¨"å’Œ"é«˜æ•ˆ"ä¹‹é—´å–å¾—æœ€ä½³å¹³è¡¡ï¼Œä¸è¿½æ±‚ç»å¯¹ä¸æ­»ï¼Œè€Œæ˜¯é€šè¿‡æ™ºèƒ½å†³ç­–æœ€å¤§åŒ–ç”Ÿå­˜æ—¶é—´å’Œåƒåˆ°è‹¹æœçš„æ•°é‡ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹© A*ï¼Ÿ

âœ… **é«˜æ•ˆ**ï¼šå¿«é€Ÿæ‰¾åˆ°æœ€çŸ­è·¯å¾„  
âœ… **æ™ºèƒ½**ï¼šèƒ½é¢„æµ‹å±é™©å¹¶é¿å¼€  
âœ… **å®ç”¨**ï¼šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¡¨ç°ä¼˜å¼‚  
âœ… **å¯é **ï¼šé…åˆå°¾éšç­–ç•¥ï¼ŒæˆåŠŸç‡æé«˜

---

## ğŸ’¡ æ ¸å¿ƒæ€æƒ³

### A* ä»£ä»·å‡½æ•°

```
f(n) = g(n) + h(n)
```

- **g(n)**ï¼šä»èµ·ç‚¹åˆ°å½“å‰èŠ‚ç‚¹ n çš„**å®é™…ä»£ä»·**ï¼ˆå·²èµ°æ­¥æ•°ï¼‰
- **h(n)**ï¼šä»å½“å‰èŠ‚ç‚¹ n åˆ°ç›®æ ‡çš„**é¢„ä¼°ä»£ä»·**ï¼ˆå¯å‘å‡½æ•°ï¼Œä½¿ç”¨æ›¼å“ˆé¡¿è·ç¦»ï¼‰

### åŸºæœ¬æµç¨‹

```
1. ä½¿ç”¨ A* æ‰¾åˆ°ä»è›‡å¤´åˆ°è‹¹æœçš„æœ€çŸ­è·¯å¾„
2. å¦‚æœè·¯å¾„å®‰å…¨ï¼ˆå°¾éšç­–ç•¥æ£€æŸ¥ï¼‰ï¼Œæ²¿è·¯å¾„ç§»åŠ¨
3. å¦‚æœè·¯å¾„ä¸å®‰å…¨ï¼Œè¿›å…¥"è·Ÿéšè›‡å°¾"æ¨¡å¼
4. åƒåˆ°è‹¹æœåï¼Œé‡å¤æ­¥éª¤ 1
```

---

## ğŸ”„ å…±äº«å†…å­˜æ¶æ„

ç”±äºæ¸¸æˆä¸æ”¯æŒ `class`ï¼Œæˆ‘ä»¬ä½¿ç”¨**å…±äº«å†…å­˜æ¨¡å¼**å®ç°æ•°æ®ç»“æ„ã€‚

### æ¶æ„è®¾è®¡

```python
# 1. åˆ›å»ºå…±äº«æ•°æ®æºæ— äººæœº
shared_data_source = spawn_drone(create_shared_data)

# 2. æ‰€æœ‰å·¥ä½œå‡½æ•°è·å–åŒä¸€ä¸ªå…±äº«æ•°æ®å¼•ç”¨
shared = wait_for(shared_data_source)

# 3. æ‰€æœ‰å‡½æ•°é€šè¿‡ shared å­—å…¸æ“ä½œåŒä¸€ä»½æ•°æ®
def astar_search(shared, ...):
    shared["priority_queue"]  # æ‰€æœ‰å‡½æ•°çœ‹åˆ°çš„æ˜¯åŒä¸€ä¸ªé˜Ÿåˆ—
    shared["snake_body"]      # æ‰€æœ‰å‡½æ•°çœ‹åˆ°çš„æ˜¯åŒä¸€æ¡è›‡
```

### å…±äº«æ•°æ®ç»“æ„

```python
shared = {
    # è›‡èº«ä½ç½®åˆ—è¡¨
    "snake_body": [(x, y), ...],
    
    # åœ°å›¾å¤§å°
    "world_size": 6,
    
    # ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆA* ä½¿ç”¨ï¼‰
    "priority_queue": [(priority, (x, y)), ...],
    
    # A* ä¸´æ—¶æ•°æ®
    "came_from": {(x,y): ((prev_x, prev_y), direction)},
    "g_score": {(x,y): cost},
    
    # ç»Ÿè®¡æ•°æ®
    "apples_eaten": 0,
    "start_tick": 0
}
```

### ä¼˜å…ˆé˜Ÿåˆ—å®ç°

```python
def pq_push(shared, item, priority):
    # æ’å…¥å…ƒç´ å¹¶ä¿æŒæœ‰åºï¼ˆæ’å…¥æ’åºï¼‰
    pq = shared["priority_queue"]
    pq.append((priority, item))
    
    # å†’æ³¡åˆ°æ­£ç¡®ä½ç½®
    i = len(pq) - 1
    while i > 0:
        if pq[i][0] < pq[i-1][0]:
            # äº¤æ¢
            temp = pq[i]
            pq[i] = pq[i-1]
            pq[i-1] = temp
            i -= 1
        else:
            break

def pq_pop(shared):
    # å¼¹å‡ºä¼˜å…ˆçº§æœ€é«˜ï¼ˆå€¼æœ€å°ï¼‰çš„å…ƒç´ 
    pq = shared["priority_queue"]
    if len(pq) > 0:
        return pq.pop(0)[1]  # è¿”å› (x, y)
    return None
```

---

## ğŸ” A* ç®—æ³•å®ç°

### æ ¸å¿ƒé€»è¾‘

```python
def astar_search(shared, start_x, start_y, goal_x, goal_y, ignore_tail):
    # 1. åˆå§‹åŒ–
    pq_clear(shared)
    shared["came_from"] = {}
    shared["g_score"] = {}
    
    # 2. æ·»åŠ èµ·ç‚¹
    start_pos = (start_x, start_y)
    pq_push(shared, start_pos, 0)
    shared["g_score"][start_pos] = 0
    
    # 3. A* ä¸»å¾ªç¯
    while not pq_is_empty(shared):
        current = pq_pop(shared)
        current_x, current_y = current[0], current[1]
        
        # åˆ°è¾¾ç›®æ ‡ï¼Ÿ
        if current_x == goal_x and current_y == goal_y:
            return reconstruct_path(shared, current)
        
        # æ£€æŸ¥æ‰€æœ‰é‚»å±…
        for (nx, ny, direction) in get_neighbors(shared, current_x, current_y):
            # å®‰å…¨æ£€æŸ¥
            if not is_position_safe(shared, nx, ny, ignore_tail):
                continue
            
            # è®¡ç®—æ–°ä»£ä»·
            tentative_g = shared["g_score"][(current_x, current_y)] + 1
            
            # æ›´æ–°è·¯å¾„
            if (nx, ny) not in g_score or tentative_g < g_score[(nx, ny)]:
                shared["came_from"][(nx, ny)] = ((current_x, current_y), direction)
                shared["g_score"][(nx, ny)] = tentative_g
                
                # f = g + h
                h = manhattan_distance(shared, nx, ny, goal_x, goal_y)
                f = tentative_g + h
                
                pq_push(shared, (nx, ny), f)
    
    # æ‰¾ä¸åˆ°è·¯å¾„
    return None
```

### å¯å‘å‡½æ•°ï¼ˆæ›¼å“ˆé¡¿è·ç¦»ï¼‰

```python
def manhattan_distance(shared, x1, y1, x2, y2):
    world_size = shared["world_size"]
    
    dx = abs(x1 - x2)
    dy = abs(y1 - y2)
    
    # ç¯å½¢åœ°å›¾ä¼˜åŒ–ï¼šè€ƒè™‘ç»•åœ°å›¾è¾¹ç¼˜çš„è·ç¦»
    dx = min(dx, world_size - dx)
    dy = min(dy, world_size - dy)
    
    return dx + dy
```

### å®‰å…¨æ£€æŸ¥

```python
def is_position_safe(shared, x, y, ignore_tail):
    snake_body = shared["snake_body"]
    
    # æ˜¯å¦å¿½ç•¥è›‡å°¾ï¼ˆå› ä¸ºè›‡å°¾ä¼šç§»åŠ¨ï¼‰
    body_to_check = snake_body
    if ignore_tail and len(snake_body) > 0:
        body_to_check = snake_body[:-1]
    
    # æ£€æŸ¥æ˜¯å¦ä¸è›‡èº«ç¢°æ’
    for (bx, by) in body_to_check:
        if bx == x and by == y:
            return False
    
    return True
```

---

## ğŸ¯ å°¾éšç­–ç•¥

**å°¾éšç­–ç•¥**æ˜¯ç®—æ³•çš„çµé­‚ï¼Œå®ƒç¡®ä¿è›‡ä¸ä¼šæŠŠè‡ªå·±å›°æ­»ã€‚

### æ ¸å¿ƒæ€æƒ³

åœ¨å†³å®šæ˜¯å¦åƒè‹¹æœä¹‹å‰ï¼Œè¿›è¡Œ**è™šæ‹Ÿæ¢æµ‹**ï¼š

```
å‡è®¾è›‡å¤´å·²ç»èµ°åˆ°è‹¹æœä½ç½®å¹¶åƒæ‰äº†è‹¹æœ
  â†“
æ£€æŸ¥æ­¤æ—¶è›‡å¤´èƒ½å¦æ‰¾åˆ°ä¸€æ¡è·¯å¾„åˆ°è¾¾è›‡å°¾
  â†“
å¦‚æœèƒ½åˆ°è¾¾ â†’ å®‰å…¨ï¼Œå¯ä»¥å»åƒè‹¹æœ
å¦‚æœä¸èƒ½åˆ°è¾¾ â†’ å±é™©ï¼Œä¼šå›°æ­»è‡ªå·±
```

### å®ç°ä»£ç 

```python
def is_safe_to_eat_apple(shared, apple_x, apple_y, head_x, head_y):
    # 1. æ‰¾åˆ°ä»è›‡å¤´åˆ°è‹¹æœçš„è·¯å¾„
    path_to_apple = astar_search(shared, head_x, head_y, apple_x, apple_y, True)
    
    if path_to_apple == None:
        return False  # è¿è‹¹æœéƒ½åˆ°ä¸äº†
    
    # 2. åˆ›å»ºè™šæ‹Ÿè›‡èº«ï¼ˆå‡è®¾å·²ç»åƒåˆ°è‹¹æœï¼‰
    original_body = shared["snake_body"]
    virtual_body = []
    
    for pos in original_body:
        virtual_body.append(pos)
    
    # æ·»åŠ æ–°è›‡å¤´ï¼ˆåœ¨è‹¹æœä½ç½®ï¼‰
    virtual_body.insert(0, (apple_x, apple_y))
    # åƒåˆ°è‹¹æœï¼Œé•¿åº¦å¢åŠ ï¼Œä¸ç§»é™¤è›‡å°¾
    
    # 3. è·å–è™šæ‹Ÿè›‡å°¾ä½ç½®
    virtual_tail = virtual_body[-1]
    tail_x, tail_y = virtual_tail[0], virtual_tail[1]
    
    # 4. ä¸´æ—¶ä½¿ç”¨è™šæ‹Ÿè›‡èº«
    shared["snake_body"] = virtual_body
    
    # 5. æ£€æŸ¥è™šæ‹Ÿè›‡å¤´èƒ½å¦åˆ°è¾¾è™šæ‹Ÿè›‡å°¾
    path_to_tail = astar_search(shared, apple_x, apple_y, tail_x, tail_y, True)
    
    # 6. æ¢å¤åŸå§‹è›‡èº«
    shared["snake_body"] = original_body
    
    # 7. è¿”å›ç»“æœ
    return path_to_tail != None
```

### ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ

- âœ… **è¿é€šæ€§ä¿è¯**ï¼šå¦‚æœèƒ½ä»è›‡å¤´åˆ°è›‡å°¾ï¼Œè¯´æ˜è›‡èº«æ˜¯è¿é€šçš„
- âœ… **é¿å…å›°æ­»**ï¼šæå‰é¢„æµ‹ä¼šä¸ä¼šæŠŠè‡ªå·±å›°åœ¨æŸä¸ªåŒºåŸŸ
- âœ… **åŠ¨æ€é€‚åº”**ï¼šéšç€è›‡å˜é•¿ï¼Œè‡ªåŠ¨è°ƒæ•´ç­–ç•¥

---

## ğŸ›¡ï¸ å®‰å…¨æ¨¡å¼ï¼šè·Ÿéšè›‡å°¾

å½“åƒè‹¹æœä¸å®‰å…¨æ—¶ï¼Œè¿›å…¥**è·Ÿéšè›‡å°¾æ¨¡å¼**ã€‚

### ç­–ç•¥

```python
def follow_tail(shared, head_x, head_y):
    # è·å–è›‡å°¾ä½ç½®
    tail = get_tail_position(shared)
    
    if tail == None:
        return None
    
    tail_x, tail_y = tail[0], tail[1]
    
    # ä½¿ç”¨ A* æ‰¾åˆ°åˆ°è›‡å°¾çš„è·¯å¾„
    path = astar_search(shared, head_x, head_y, tail_x, tail_y, True)
    
    if path != None and len(path) > 0:
        # è¿”å›ç¬¬ä¸€æ­¥æ–¹å‘
        return path[0]
    
    return None
```

### ä¸ºä»€ä¹ˆè·Ÿéšè›‡å°¾ï¼Ÿ

- è›‡å°¾æ¯æ­¥éƒ½ä¼šç§»åŠ¨ï¼Œä¸ºè›‡å¤´è…¾å‡ºç©ºé—´
- è·Ÿéšè›‡å°¾ç›¸å½“äºåœ¨ç©ºåœ°ä¸Šç»•åœˆ
- é¿å…è¢«å›°ï¼Œç­‰å¾…å®‰å…¨çš„åƒè‹¹æœæœºä¼š

### å®Œæ•´å†³ç­–æµç¨‹

```
å¼€å§‹
  â†“
æ‰¾åˆ°è‹¹æœä½ç½®
  â†“
è™šæ‹Ÿæ¢æµ‹ï¼šåƒè‹¹æœå®‰å…¨å—ï¼Ÿ
  â†“
 â”œâ”€ å®‰å…¨ â†’ ä½¿ç”¨ A* æ‰¾è·¯å¾„ â†’ æ²¿è·¯å¾„ç§»åŠ¨ä¸€æ­¥
 â”‚                           â†“
 â”‚                         åƒåˆ°è‹¹æœäº†å—ï¼Ÿ
 â”‚                           â†“
 â”‚                    â”œâ”€ æ˜¯ â†’ ç»§ç»­
 â”‚                    â””â”€ å¦ â†’ ç»§ç»­æ²¿è·¯å¾„
 â”‚
 â””â”€ ä¸å®‰å…¨ â†’ è·Ÿéšè›‡å°¾æ¨¡å¼ â†’ ç§»åŠ¨ä¸€æ­¥
              â†“
            ç­‰å¾…å®‰å…¨æœºä¼š
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. é…ç½®å‚æ•°

```python
# ç›®æ ‡å°¾å·´é•¿åº¦
TARGET_LENGTH = 36  # 6x6 åœ°å›¾æ¨èå€¼

# æ˜¯å¦æ‰“å°è¯¦ç»†æ—¥å¿—
VERBOSE = True
```

### 2. æ¨èé•¿åº¦ï¼ˆæ ¹æ®åœ°å›¾å¤§å°ï¼‰

| åœ°å›¾å¤§å° | æ¨èé•¿åº¦ | éª¨å¤´æ•°é‡ | è¯´æ˜ |
|---------|---------|---------|------|
| 3x3 | 9 | 81 | å¡«æ»¡åœ°å›¾ |
| 4x4 | 16 | 256 | å¡«æ»¡åœ°å›¾ |
| 5x5 | 20-25 | 400-625 | é«˜æ•ˆå¹³è¡¡ |
| 6x6 | 30-36 | 900-1296 | é«˜æ•ˆå¹³è¡¡ |
| 10x10 | 80-100 | 6400-10000 | æŒ‘æˆ˜æ¨¡å¼ |

### 3. è¿è¡Œè„šæœ¬

```python
# ç›´æ¥è¿è¡Œ
run_dinosaur_astar()
```

### 4. è¾“å‡ºç¤ºä¾‹

```
======================
A* æé¾™æ•ˆç‡é¢„æµ‹
======================
é•¿åº¦ | éª¨å¤´æ•°
10 | 100
16 | 256
20 | 400
25 | 625
36 | 1296
======================

å¼€å§‹ A* æ™ºèƒ½æé¾™å…»æ®–...
ç›®æ ‡é•¿åº¦: 36
åœ°å›¾å¤§å°: 6x6
å‡†å¤‡å†œåœº...
å†œåœºå‡†å¤‡å®Œæˆ
è£…å¤‡æé¾™å¸½...
æé¾™å¸½å·²è£…å¤‡
å¼€å§‹ A* æ™ºèƒ½åƒè‹¹æœï¼Œç›®æ ‡é•¿åº¦: 36
å·²åƒè‹¹æœ: 5/36
å·²åƒè‹¹æœ: 10/36
å·²åƒè‹¹æœ: 15/36
...
å°¾å·´å¢é•¿å®Œæˆ! æœ€ç»ˆé•¿åº¦: 36
å¸ä¸‹æé¾™å¸½ï¼Œæ”¶è·éª¨å¤´...

======================
A* æé¾™å…»æ®–å®Œæˆ!
======================
å°¾å·´é•¿åº¦: 36
åƒæ‰è‹¹æœ: 36
æ”¶è·éª¨å¤´: 1296
æ€»æ¶ˆè€—ticks: 45000
æ¯éª¨å¤´æˆæœ¬: 34 ticks
æ•ˆç‡è¯„çº§: â­â­â­â­â­ ä¼˜ç§€!
======================
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. ç¯å½¢åœ°å›¾ä¼˜åŒ–

```python
# è€ƒè™‘ä»åœ°å›¾è¾¹ç¼˜ç»•è¿‡å»çš„è·ç¦»
dx = min(dx, world_size - dx)
dy = min(dy, world_size - dy)
```

### 2. å¿½ç•¥è›‡å°¾

```python
# è›‡å°¾ä¼šç§»åŠ¨ï¼Œå¯ä»¥å®‰å…¨é€šè¿‡
if ignore_tail and len(snake_body) > 0:
    body_to_check = snake_body[:-1]
```

### 3. è¿­ä»£é™åˆ¶

```python
# é˜²æ­¢æ— é™å¾ªç¯
max_iterations = world_size * world_size * 2
```

### 4. å…±äº«æ•°æ®æ¶æ„

- é¿å…é‡å¤åˆ›å»ºæ•°æ®ç»“æ„
- æ‰€æœ‰å‡½æ•°å…±äº«åŒä¸€ä»½å†…å­˜
- å‡å°‘æ•°æ®å¤åˆ¶å¼€é”€

---

## ğŸ“ ç®—æ³•ä¼˜ç¼ºç‚¹

### âœ… ä¼˜ç‚¹

1. **é«˜æ•ˆæ™ºèƒ½**ï¼šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¿«é€Ÿæ‰¾åˆ°é£Ÿç‰©
2. **å®‰å…¨å¯é **ï¼šå°¾éšç­–ç•¥æœ‰æ•ˆé¿å…æ­»å±€
3. **å®ç”¨æ€§å¼º**ï¼šå®ç°ç›¸å¯¹ç›´è§‚ï¼Œé€‚åˆå„ç§åœ°å›¾
4. **æ€§èƒ½ä¼˜å¼‚**ï¼šåœ¨ 6x6 åœ°å›¾ä¸Šè¡¨ç°å‡ºè‰²

### âš ï¸ ç¼ºç‚¹

1. **éç»å¯¹æ— æ•Œ**ï¼šåœ¨æç«¯å¤æ‚åœ°å½¢å¯èƒ½å¤±è¯¯
2. **è®¡ç®—å¼€é”€**ï¼šå¤§åœ°å›¾ä¸Šæ¯æ­¥éƒ½è¿›è¡Œ A* + è™šæ‹Ÿæ¢æµ‹æœ‰æ€§èƒ½å‹åŠ›
3. **å†…å­˜æ¶ˆè€—**ï¼šéœ€è¦ç»´æŠ¤å¤šä¸ªå­—å…¸å’Œåˆ—è¡¨

---

## ğŸ”¬ è¿›é˜¶ä¼˜åŒ–å»ºè®®

### 1. æ›´æ™ºèƒ½çš„å¯å‘å‡½æ•°

```python
# è€ƒè™‘è›‡èº«å¯†åº¦
def smart_heuristic(shared, x, y, goal_x, goal_y):
    base_h = manhattan_distance(shared, x, y, goal_x, goal_y)
    
    # è®¡ç®—å‘¨å›´è›‡èº«å¯†åº¦
    density = count_nearby_body(shared, x, y)
    
    return base_h + density * 2
```

### 2. è·¯å¾„å¹³æ»‘

```python
# ä¼˜å…ˆé€‰æ‹©å‡å°‘è½¬å‘çš„è·¯å¾„
if len(path) > 1:
    if path[0] == last_direction:
        priority -= 0.1  # åŒæ–¹å‘ä¼˜å…ˆ
```

### 3. åŠ¨æ€ç›®æ ‡é•¿åº¦

```python
# æ ¹æ®åœ°å›¾å¤§å°åŠ¨æ€è°ƒæ•´
max_safe_length = world_size * world_size * 0.8
TARGET_LENGTH = min(TARGET_LENGTH, max_safe_length)
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- A* ç®—æ³•ï¼š[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/A*_search_algorithm)
- è´ªåƒè›‡ AIï¼š[ç»å…¸ç®—æ³•åˆé›†]
- æ¸¸æˆ APIï¼šæŸ¥çœ‹ `__builtins__.py`

---

## ğŸ¤ è´¡çŒ®

å¦‚æœä½ æœ‰æ›´å¥½çš„ä¼˜åŒ–å»ºè®®æˆ–å‘ç° bugï¼Œæ¬¢è¿æå‡ºï¼

---

**ç¥ä½ å…»é¾™æˆåŠŸï¼Œæ”¶è·æ»¡æ»¡éª¨å¤´ï¼** ğŸ¦–ğŸ’€

