# 基础资源农场 - 肥料功能说明

## 功能概述

在 `resource_farm_mega.py` 中新增**智能施肥系统**：
- ✅ 只对有伴生需求的作物施肥
- ✅ 加速生长（减少 2 秒成熟时间）
- ✅ 获得奇异物质（50% 产量转化）
- ✅ 自动统计施肥使用量

## 工作原理

### 伴生检测机制

```python
# 检查当前位置是否有伴生需求
pos_key = y * SIZE + x
has_companion = pos_key in companion_map

if has_companion:
    # 这是伴生作物 → 施肥
    plant(crop)
    if num_items(Items.Fertilizer) > 0:
        use_item(Items.Fertilizer)  # 施肥
else:
    # 普通作物 → 不施肥
    plant(crop)
```

### 为什么只对伴生作物施肥？

**伴生作物的特点：**
1. **高价值** - 有伴生加成，产量是 5× 起步
2. **长期收益** - 伴生关系会保持多个循环
3. **战略位置** - 通常处于关键位置

**施肥的好处：**
- ⚡ 加速成熟：减少 2 秒生长时间
- 💰 奇异物质：收获时 50% 转化为奇异物质
- 🎯 资源优化：肥料用在刀刃上

## 施肥策略

### 对比分析

| 作物类型 | 是否施肥 | 原因 |
|---------|---------|------|
| **伴生作物** | ✅ 施肥 | 高产值，值得投资 |
| **普通草** | ❌ 不施肥 | 产量低，不划算 |
| **普通树** | ❌ 不施肥 | 位置随机，非关键 |
| **普通胡萝卜** | ❌ 不施肥 | 产量一般 |

### 效益计算

**伴生作物施肥收益：**
```
伴生加成：5× 基础产量
施肥加速：节省 2 秒 = 更快收获
奇异物质：50% 产量转化

示例：伴生草
- 基础：1 干草
- 伴生：5 干草
- 施肥后收获：2.5 干草 + 2.5 奇异物质
- 额外收益：2.5 奇异物质（可用于迷宫）
```

**普通作物施肥收益：**
```
无伴生加成：1× 基础产量
施肥加速：节省 2 秒
奇异物质：50% 产量转化

示例：普通草
- 基础：1 干草
- 施肥后收获：0.5 干草 + 0.5 奇异物质
- 损失：0.5 干草
- 不划算！
```

## 统计输出

### 新增施肥统计

```
统计 - 收:4256 树:80 萝:120 草:4056 肥:350
                                      ↑
                                   施肥次数
```

### 解读施肥数据

**施肥次数分析：**
```python
伴生比例 = 施肥次数 / (树 + 萝 + 草)

# 示例：
# 施肥 350 次，种植 4256 株
# 伴生比例 = 350 / 4256 ≈ 8.2%

# 说明：
# - 低比例（<5%）：伴生地图还在建立
# - 中等（5-15%）：正常运行状态
# - 高比例（>15%）：伴生网络成熟
```

## 肥料来源

### 自动生成
```python
# 每 10 秒自动获得 1 份肥料
# 每次升级 Unlocks.Fertilizer，生成速度翻倍

生成速度 = 1 / (10 / 2^升级次数)

# 升级 0 次：10 秒/份 = 6 份/分钟
# 升级 1 次：5 秒/份 = 12 份/分钟
# 升级 2 次：2.5 秒/份 = 24 份/分钟
# 升级 3 次：1.25 秒/份 = 48 份/分钟
```

### 使用速度

**16×16 农场，8% 伴生率：**
```
每轮种植：256 株
施肥作物：256 × 8% ≈ 20 株
肥料消耗：20 份/轮

轮次时间（估算）：
- 移动：255 × 200 ticks = 51,000 ticks
- 种植：256 × 200 ticks = 51,200 ticks
- 总计：约 102,000 ticks ≈ 4 分钟（有能量加速）

肥料需求：20 份/4分钟 = 5 份/分钟

结论：
- 升级 0 次：6 份/分钟 → 供大于求 ✅
- 可以长期稳定运行
```

## 奇异物质收益

### 累积计算

**长期运行（1小时）：**
```
假设数据：
- 轮次：15 次/小时
- 施肥：20 株/轮
- 收获转化：50%

奇异物质获得：
- 草（伴生）：5 × 50% = 2.5 /株
- 树（伴生）：25 × 50% = 12.5 /株  
- 胡萝卜（伴生）：5 × 50% = 2.5 /株

1 小时累计：
约 20 × 15 × 平均3 = 900 份奇异物质
```

### 奇异物质用途

1. **生成迷宫**
   ```python
   # n×n 迷宫需要 n 份奇异物质
   # 每次升级需要 2 倍
   
   16×16 迷宫（0 级）：16 份
   16×16 迷宫（1 级）：32 份
   16×16 迷宫（2 级）：64 份
   ```

2. **切换感染状态**
   ```python
   # 治愈感染的作物
   # 或感染健康的作物
   use_item(Items.Weird_Substance)
   ```

## 配置选项

### 禁用施肥（如果需要）

如果你不想使用肥料，可以注释掉施肥代码：

```python
# 在 drone_worker 函数中，注释这几行：
# if num_items(Items.Fertilizer) > 0:
#     use_item(Items.Fertilizer)
#     local_fertilized = local_fertilized + 1
```

### 改为全部施肥

如果想对所有作物施肥：

```python
# 在种植后立即施肥
plant(crop)
if num_items(Items.Fertilizer) > 0:
    use_item(Items.Fertilizer)
    local_fertilized = local_fertilized + 1
```

### 条件施肥

根据特定条件施肥：

```python
# 只对树施肥
if comp_type == Entities.Tree:
    if num_items(Items.Fertilizer) > 0:
        use_item(Items.Fertilizer)

# 只在肥料充足时施肥
if num_items(Items.Fertilizer) > 100:
    use_item(Items.Fertilizer)
```

## 感染管理

### 感染机制

```
施肥作物 → 被感染 → 收获时 50% 转化奇异物质

示例：
- 正常收获：10 木材
- 感染收获：5 木材 + 5 奇异物质
```

### 感染传播

```python
# 使用奇异物质会切换感染状态
use_item(Items.Weird_Substance)

效果：
- 感染作物 → 治愈（同时感染相邻健康作物）
- 健康作物 → 感染（同时治愈相邻感染作物）
```

### 处理策略

**策略 1：接受感染（推荐）**
```python
# 不做处理，接受 50% 转化
# 优点：获得奇异物质
# 缺点：基础资源减半
```

**策略 2：完全隔离**
```python
# 分区管理：
# - 感染区：伴生作物（施肥）
# - 清洁区：普通作物（不施肥）
```

**策略 3：定期治愈**
```python
# 在收获前使用奇异物质治愈
# 优点：保持全产量
# 缺点：消耗奇异物质
```

## 性能影响

### Tick 成本

```python
# 施肥操作
use_item(Items.Fertilizer)  # 200 ticks

# 每轮额外成本：
20 株施肥 × 200 ticks = 4,000 ticks

# 占总成本比例：
4,000 / 102,000 ≈ 3.9%
```

### 时间收益

```python
# 施肥加速：减少 2 秒生长时间
# 对于慢速作物（树 7秒，胡萝卜 6秒）：
# 节省比例：2/7 ≈ 28.6%

# 虽然种植多花 3.9% tick
# 但成熟快 28.6%
# 净收益：约 24% 时间节省
```

## 监控建议

### 关键指标

**1. 肥料库存**
```python
fertilizer_stock = num_items(Items.Fertilizer)
if fertilizer_stock < 50:
    quick_print("警告：肥料不足")
```

**2. 施肥效率**
```python
fertilize_rate = fertilized / (trees + carrots + grass)
quick_print("施肥率: " + str(fertilize_rate * 100) + "%")
```

**3. 奇异物质累积**
```python
weird_substance = num_items(Items.Weird_Substance)
quick_print("奇异物质: " + str(weird_substance))
```

### 优化建议

**升级优先级：**
1. ⭐⭐⭐ `Unlocks.Fertilizer` - 提高肥料生成速度
2. ⭐⭐⭐ `Unlocks.Polyculture` - 增加伴生产量
3. ⭐⭐ `Unlocks.Watering` - 配合浇水进一步加速

**运行建议：**
1. 优先解锁 Polyculture（伴生种植）
2. 至少升级 Fertilizer 1-2 次
3. 长期运行（数小时）以积累奇异物质
4. 定期检查肥料库存

## 实际效果

### 预期收益

**相比无肥料版本：**
```
伴生作物加速：~28% 更快成熟
奇异物质产出：每小时 ~900 份
长期收益：
- 可生成数十个迷宫
- 获取大量金币
- 解锁高级功能
```

### 运行示例

```
=== 持久化多无人机农场 V2 ===
农场大小：16x16
最大无人机：16

=== 启动无人机池 ===
成功启动 15 个持久无人机

=== 资源 ===
干:50000/1000000000
木:25000/500000000
萝:12000/500000000
优先级: 草

统计 - 收:4256 树:80 萝:120 草:4056 肥:350
                                       ↑
                                 施肥350次
                                 
获得奇异物质：约 350 × 3 = 1050 份
可生成迷宫：1050 / 16 = 65 个 16×16 迷宫！
```

## 总结

### ✅ 肥料功能优势

- 🎯 **精准施肥**：只对高价值伴生作物使用
- ⚡ **加速成长**：减少 28% 等待时间
- 💎 **奇异物质**：自动获取迷宫资源
- 📊 **实时统计**：监控施肥效率
- 🔄 **自动管理**：无需手动干预

### 🎮 使用建议

1. **解锁 Fertilizer** - 确保有肥料供应
2. **解锁 Polyculture** - 激活伴生机制
3. **长期运行** - 让系统自动优化
4. **监控统计** - 观察施肥效率
5. **收集物质** - 用于生成迷宫获取金币

**这个肥料系统是基础资源收集的重要增强，让你同时获得基础资源和高级资源（奇异物质）！** 🌟

