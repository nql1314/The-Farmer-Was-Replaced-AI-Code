# æŒä¹…åŒ–æ— äººæœºæ± æ¶æ„è®¾è®¡

## æ¦‚è¿°

`resource_farm_mega.py` V2 ç‰ˆæœ¬é‡‡ç”¨**æŒä¹…åŒ–æ— äººæœºæ± **æ¶æ„ï¼Œå½»åº•æ”¹å˜äº†å¤šæ— äººæœºçš„ä½¿ç”¨æ–¹å¼ã€‚

## æ ¸å¿ƒç†å¿µ

### âŒ æ—§æ¶æ„ï¼ˆV1ï¼‰ï¼šé‡å¤åˆ›å»ºæ¨¡å¼
```python
while True:
    # æ¯ä¸ªå¾ªç¯éƒ½é‡æ–°åˆ›å»ºæ— äººæœº
    for region in regions:
        drone = spawn_drone(task)  # æ¯æ¬¡ 200 ticks
        drones.append(drone)
    
    # ç­‰å¾…æ‰€æœ‰æ— äººæœºå®Œæˆ
    for drone in drones:
        wait_for(drone)
    
    # æ— äººæœºç»“æŸï¼Œä¸‹æ¬¡å¾ªç¯é‡æ–°åˆ›å»º
```

**é—®é¢˜ï¼š**
- æ¯ä¸ªå¾ªç¯æµªè´¹å¤§é‡ ticks åˆ›å»ºæ— äººæœº
- æ— äººæœºå·¥ä½œå®Œå°±é”€æ¯ï¼Œèµ„æºæµªè´¹
- ä¸»æœºå¤§éƒ¨åˆ†æ—¶é—´åœ¨ç­‰å¾…

### âœ… æ–°æ¶æ„ï¼ˆV2ï¼‰ï¼šæŒä¹…åŒ–æ± æ¨¡å¼
```python
# å¯åŠ¨é˜¶æ®µï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰
drones = start_drone_pool()  # åˆ›å»ºæŒä¹…åŒ–æ— äººæœº

# æ¯ä¸ªæ— äººæœºç‹¬ç«‹è¿è¡Œ
def drone_worker(region):
    while True:  # æ— é™å¾ªç¯
        # å¤„ç†æ•´ä¸ªåŒºåŸŸ
        # è‡ªåŠ¨è·å–æœ€æ–°ä¼˜å…ˆçº§
        # æŒç»­å·¥ä½œï¼Œæ°¸ä¸åœæ­¢

# ä¸»å¾ªç¯ï¼ˆè½»é‡çº§ï¼‰
while True:
    # åªè´Ÿè´£æ›´æ–°ä¼˜å…ˆçº§å’Œç›‘æ§
    shared["priority"] = get_priority()
    # æ— äººæœºè‡ªåŠ¨å“åº”ä¼˜å…ˆçº§å˜åŒ–
```

**ä¼˜åŠ¿ï¼š**
- âœ… æ— äººæœºåªåˆ›å»ºä¸€æ¬¡ï¼ˆèŠ‚çœæ•°åƒ ticksï¼‰
- âœ… æŒç»­è¿è¡Œï¼Œæ— åœæœºæ—¶é—´
- âœ… ä¸»æœºåªè´Ÿè´£ç›‘æ§å’Œåè°ƒ
- âœ… çœŸæ­£çš„å¹¶è¡Œæ‰§è¡Œ

## æŠ€æœ¯å®ç°

### 1. å…±äº«å†…å­˜æœºåˆ¶

åˆ©ç”¨ `wait_for()` å®ç°çœŸæ­£çš„å…±äº«æ•°æ®ï¼š

```python
# åˆ›å»ºå…±äº«æ•°æ®æº
def create_shared_data():
    return {
        "companion_map": {},      # ä¼´ç”Ÿåœ°å›¾
        "priority": 0,            # å½“å‰ä¼˜å…ˆçº§
        "should_stop": False,     # åœæ­¢ä¿¡å·
        "stats": {}               # ç»Ÿè®¡æ•°æ®
    }

shared_source = spawn_drone(create_shared_data)
shared = wait_for(shared_source)

# æ‰€æœ‰æ— äººæœºé€šè¿‡ wait_for(shared_source) è·å–åŒä¸€ä¸ªå¯¹è±¡
# ä¿®æ”¹ä¼šç«‹å³å¯¹æ‰€æœ‰æ— äººæœºå¯è§ï¼
```

### 2. æ— äººæœºæŒä¹…åŒ–å·¥ä½œå¾ªç¯

```python
def drone_worker(region_id, x_start, x_end, y_start, y_end):
    # è·å–å…±äº«æ•°æ®ï¼ˆæ‰€æœ‰æ— äººæœºå…±äº«åŒä¸€ä»½ï¼‰
    data = wait_for(shared_source)
    
    # æ— é™å¾ªç¯
    while True:
        # æ£€æŸ¥åœæ­¢ä¿¡å·
        if data["should_stop"]:
            break
        
        # è·å–æœ€æ–°ä¼˜å…ˆçº§
        priority = data["priority"]
        
        # å¤„ç†æ•´ä¸ªåŒºåŸŸ
        for each_tile in region:
            harvest()
            plant_based_on_priority(priority)
        
        # æ›´æ–°ç»Ÿè®¡ï¼ˆä½¿ç”¨ç‹¬ç«‹é”®é¿å…å†²çªï¼‰
        data["stats"]["region_" + str(region_id)] = stats
```

### 3. ä¸»æœºç›‘æ§å¾ªç¯

```python
# å¯åŠ¨æ— äººæœºï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰
drones = start_drone_pool()

# ä¸»å¾ªç¯ï¼ˆè½»é‡çº§ï¼‰
while True:
    # æ›´æ–°ä¼˜å…ˆçº§
    shared["priority"] = get_priority()
    
    # æ˜¾ç¤ºçŠ¶æ€
    show_status()
    
    # ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆè®©æ— äººæœºå·¥ä½œï¼‰
    for i in range(10):
        do_a_flip()
```

## æ€§èƒ½å¯¹æ¯”

### V1 æ¶æ„ï¼ˆé‡å¤åˆ›å»ºï¼‰

**æ¯ä¸ªå¾ªç¯çš„ Tick æˆæœ¬ï¼š**
```
åˆ›å»º 15 ä¸ªæ— äººæœºï¼š15 Ã— 200 = 3,000 ticks
ç­‰å¾…æ— äººæœºå·¥ä½œï¼š~3,200 ticksï¼ˆå®é™…å·¥ä½œï¼‰
é”€æ¯æ— äººæœºï¼š0 ticksï¼ˆè‡ªåŠ¨ï¼‰
--------------------------------------------
æ€»è®¡ï¼š~6,200 ticks/å¾ªç¯
```

### V2 æ¶æ„ï¼ˆæŒä¹…åŒ–ï¼‰

**å¯åŠ¨é˜¶æ®µï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š**
```
åˆ›å»º 15 ä¸ªæ— äººæœºï¼š15 Ã— 200 = 3,000 ticks
```

**æ¯ä¸ªå¾ªç¯çš„ Tick æˆæœ¬ï¼š**
```
æ›´æ–°ä¼˜å…ˆçº§ï¼š~10 ticks
æ˜¾ç¤ºçŠ¶æ€ï¼š~50 ticks
ç­‰å¾…æ—¶é—´ï¼š10 Ã— do_a_flip()
--------------------------------------------
æ€»è®¡ï¼š~60 ticks/å¾ªç¯ï¼ˆä¸»æœºï¼‰
æ— äººæœºï¼šæŒç»­å·¥ä½œï¼ˆå¹¶è¡Œï¼‰
```

**èŠ‚çœè®¡ç®—ï¼š**
- ç¬¬ 2 æ¬¡å¾ªç¯å¼€å§‹ï¼šèŠ‚çœ 3,000 ticks
- ç¬¬ 10 æ¬¡å¾ªç¯ï¼šèŠ‚çœ 30,000 ticks
- ç¬¬ 100 æ¬¡å¾ªç¯ï¼šèŠ‚çœ 300,000 ticks
- **é•¿æœŸè¿è¡Œæ•ˆç‡æå‡ 50-100 å€ï¼**

## æ¶æ„ä¼˜åŠ¿

### 1. é›¶åœæœºæ—¶é—´
```
V1: [åˆ›å»º] â†’ [å·¥ä½œ] â†’ [ç­‰å¾…] â†’ [é”€æ¯] â†’ [åˆ›å»º] â†’ ...
     ^^^^                       ^^^^^^
     æµªè´¹                       æµªè´¹

V2: [åˆ›å»ºä¸€æ¬¡] â†’ [æŒç»­å·¥ä½œ] â†’ [æŒç»­å·¥ä½œ] â†’ [æŒç»­å·¥ä½œ] â†’ ...
                  ^^^^^^^^     ^^^^^^^^     ^^^^^^^^
                  å…¨ç¨‹é«˜æ•ˆ     å…¨ç¨‹é«˜æ•ˆ     å…¨ç¨‹é«˜æ•ˆ
```

### 2. åŠ¨æ€ä¼˜å…ˆçº§å“åº”
```python
# æ— äººæœºè‡ªåŠ¨å“åº”ä¼˜å…ˆçº§å˜åŒ–
# ä¸»æœºæ›´æ–°ï¼š
shared["priority"] = 2  # åˆ‡æ¢åˆ°èƒ¡èåœä¼˜å…ˆ

# æ— äººæœºåœ¨ä¸‹ä¸€æ¬¡ç§æ¤æ—¶è‡ªåŠ¨åº”ç”¨æ–°ä¼˜å…ˆçº§
# æ— éœ€åœæ­¢ã€é‡å¯æˆ–ç­‰å¾…
```

### 3. å®æ—¶ç»Ÿè®¡æ”¶é›†
```python
# æ¯ä¸ªæ— äººæœºç‹¬ç«‹æ›´æ–°è‡ªå·±çš„ç»Ÿè®¡
data["stats"]["region_0"] = (100, 20, 30, 50)
data["stats"]["region_1"] = (95, 18, 28, 49)
...

# ä¸»æœºå¯ä»¥éšæ—¶æŸ¥è¯¢æ€»ä½“è¿›åº¦
total = collect_stats()  # æ±‡æ€»æ‰€æœ‰åŒºåŸŸ
```

### 4. å¯æ‰©å±•æ€§
```python
# è½»æ¾æ”¯æŒæ›´å¤šæ— äººæœº
if max_drones() >= 25:
    # è‡ªåŠ¨åˆ›å»º 25 ä¸ªæŒä¹…æ— äººæœº
    # æ¯ä¸ªç‹¬ç«‹å·¥ä½œï¼Œäº’ä¸å¹²æ‰°

# è½»æ¾æ”¯æŒæ›´å¤šåŠŸèƒ½
shared["water_threshold"] = 0.7  # åŠ¨æ€è°ƒæ•´æµ‡æ°´é˜ˆå€¼
shared["fertilize_enabled"] = True  # åŠ¨æ€å¯ç”¨è‚¥æ–™
```

## å†…å­˜å®‰å…¨æ€§

### é¿å…ç«æ€æ¡ä»¶

```python
# âŒ å±é™©ï¼šå¤šä¸ªæ— äººæœºåŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªå€¼
data["total_harvested"] += local_harvested  # ç«æ€æ¡ä»¶ï¼

# âœ… å®‰å…¨ï¼šæ¯ä¸ªæ— äººæœºä½¿ç”¨ç‹¬ç«‹é”®
data["stats"]["region_" + str(region_id)] = local_stats

# âœ… å®‰å…¨ï¼šåªè¯»å–å…±äº«é…ç½®
priority = data["priority"]  # åªè¯»ï¼Œæ— å†²çª
companion_map = data["companion_map"]  # åªè¯»ç°æœ‰æ•°æ®
```

### å…±äº«æ•°æ®ç»“æ„

```python
shared = {
    # é…ç½®æ•°æ®ï¼ˆä¸»æœºå†™ï¼Œæ— äººæœºè¯»ï¼‰
    "priority": 0,           # ä¸»æœºå®šæœŸæ›´æ–°
    "should_stop": False,    # ä¸»æœºæ§åˆ¶åœæ­¢
    
    # å…±äº«èµ„æºï¼ˆæ‰€æœ‰æ— äººæœºè¯»å†™ï¼‰
    "companion_map": {},     # åä½œç»´æŠ¤ä¼´ç”Ÿåœ°å›¾
    
    # ç»Ÿè®¡æ•°æ®ï¼ˆæ— äººæœºå†™ï¼Œä¸»æœºè¯»ï¼‰
    "stats": {
        "region_0": (...),   # æ¯ä¸ªæ— äººæœºç‹¬ç«‹é”®
        "region_1": (...),
        # ...
    }
}
```

## ä½¿ç”¨åœºæ™¯

### é€‚ç”¨åœºæ™¯ âœ…
- **é•¿æœŸèµ„æºæ”¶é›†**ï¼šè¿è¡Œæ•°å°æ—¶ï¼ŒæŒä¹…åŒ–ä¼˜åŠ¿æ˜æ˜¾
- **åŠ¨æ€ç­–ç•¥è°ƒæ•´**ï¼šéœ€è¦æ ¹æ®èµ„æºæƒ…å†µè°ƒæ•´ä¼˜å…ˆçº§
- **å¤§è§„æ¨¡å†œåœº**ï¼š16Ã—16 æˆ–æ›´å¤§ï¼Œå……åˆ†åˆ©ç”¨å¤šæ— äººæœº
- **å¤æ‚åä½œ**ï¼šä¼´ç”Ÿç§æ¤ç­‰éœ€è¦è·¨åŒºåŸŸåä½œçš„åœºæ™¯

### ä¸é€‚ç”¨åœºæ™¯ âŒ
- **ä¸€æ¬¡æ€§ä»»åŠ¡**ï¼šåªè¿è¡Œå‡ ä¸ªå¾ªç¯ï¼Œåˆ›å»ºå¼€é”€å¯å¿½ç•¥
- **é™æ€ç­–ç•¥**ï¼šä¼˜å…ˆçº§æ°¸ä¸å˜åŒ–ï¼Œä¸éœ€è¦åŠ¨æ€è°ƒæ•´
- **å°è§„æ¨¡å†œåœº**ï¼š4Ã—4 æˆ–æ›´å°ï¼Œå•æ— äººæœºè¶³å¤Ÿé«˜æ•ˆ
- **ä¸“é¡¹ä»»åŠ¡**ï¼šå—ç“œåˆå¹¶ã€ä»™äººæŒæ’åºç­‰ç‰¹å®šç®—æ³•

## æ‰©å±•æ–¹å‘

### 1. æ™ºèƒ½è´Ÿè½½å‡è¡¡
```python
# ç›‘æ§æ¯ä¸ªæ— äººæœºçš„å®Œæˆæ—¶é—´
if region_stats["time"] > average_time * 1.5:
    # è¿™ä¸ªåŒºåŸŸå¤ªæ…¢ï¼Œè€ƒè™‘åˆ†å‰²æˆ–è°ƒæ•´
```

### 2. åŠ¨æ€åŒºåŸŸè°ƒæ•´
```python
# æ ¹æ®å·¥ä½œè´Ÿè½½åŠ¨æ€é‡æ–°åˆ†é…åŒºåŸŸ
if some_drone_idle:
    # é‡æ–°è®¡ç®—åŒºåŸŸï¼Œå¯ç”¨æ–°æ— äººæœº
```

### 3. åä½œå¼ä¼´ç”Ÿç§æ¤
```python
# æ— äººæœº A å‘ç°éœ€è¦åœ¨ B åŒºåŸŸç§æ¤ä¼´ç”Ÿ
shared["companion_requests"].append((x, y, type))
# æ— äººæœº B å¤„ç†åˆ°è¯¥ä½ç½®æ—¶è‡ªåŠ¨å“åº”
```

### 4. æ•…éšœæ¢å¤
```python
# æ£€æµ‹æ— äººæœºæ˜¯å¦å¡ä½
for region in regions:
    if not has_finished(drones[region]):
        # æ— äººæœºå¯èƒ½é‡åˆ°é—®é¢˜
        # é‡å¯è¯¥åŒºåŸŸçš„æ— äººæœº
```

## å®ç°ç»†èŠ‚

### å¯åŠ¨æµç¨‹
```
1. åˆ›å»ºå…±äº«æ•°æ®æº (spawn_drone + wait_for)
   â””â”€ æ‰€æœ‰æ— äººæœºé€šè¿‡æ­¤è·å¾—å…±äº«å†…å­˜
   
2. è®¡ç®—åŒºåŸŸåˆ’åˆ† (calculate_regions)
   â””â”€ æ ¹æ® max_drones() åŠ¨æ€åˆ†é…
   
3. å¯åŠ¨æŒä¹…åŒ–æ— äººæœºæ±  (start_drone_pool)
   â”œâ”€ ä¸ºæ¯ä¸ªåŒºåŸŸåˆ›å»ºå·¥ä½œå‡½æ•°
   â”œâ”€ spawn_drone() å¯åŠ¨æ— äººæœº
   â””â”€ æ— äººæœºç«‹å³è¿›å…¥å·¥ä½œå¾ªç¯
   
4. ä¸»å¾ªç¯å¼€å§‹
   â”œâ”€ æ›´æ–°å…±äº«ä¼˜å…ˆçº§
   â”œâ”€ æ˜¾ç¤ºçŠ¶æ€
   â””â”€ ç­‰å¾…ä¸‹æ¬¡æ£€æŸ¥
```

### è¿è¡Œæµç¨‹
```
ä¸»æœºï¼š                æ— äººæœº 0:              æ— äººæœº 1:              ...
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ›´æ–°ä¼˜å…ˆçº§ â”‚          â”‚ è¯»å–ä¼˜å…ˆçº§ â”‚           â”‚ è¯»å–ä¼˜å…ˆçº§ â”‚
â”‚ priority=1â”‚  â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ priority=1 â”‚           â”‚ priority=1 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚               â”‚ éå†åŒºåŸŸ0 â”‚           â”‚ éå†åŒºåŸŸ1 â”‚
     â”‚               â”‚ æ”¶å‰²ç§æ¤  â”‚           â”‚ æ”¶å‰²ç§æ¤  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ æ›´æ–°ç»Ÿè®¡  â”‚           â”‚ æ›´æ–°ç»Ÿè®¡  â”‚
â”‚ æ˜¾ç¤ºçŠ¶æ€  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                     â”‚
     â”‚                    â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç­‰å¾…...  â”‚          â”‚ è¯»å–ä¼˜å…ˆçº§ â”‚           â”‚ è¯»å–ä¼˜å…ˆçº§ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ (å¯èƒ½å˜äº†)â”‚           â”‚ (å¯èƒ½å˜äº†)â”‚
     â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚               â”‚ éå†åŒºåŸŸ0 â”‚           â”‚ éå†åŒºåŸŸ1 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ (æ–°ä¼˜å…ˆçº§)â”‚           â”‚ (æ–°ä¼˜å…ˆçº§)â”‚
â”‚ æ›´æ–°ä¼˜å…ˆçº§ â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ priority=2â”‚  â”€â”€â”€â”€â”€â”€â”€â”€> ...                  ...
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ€§èƒ½ç›‘æ§

### æ·»åŠ æ€§èƒ½ç»Ÿè®¡
```python
# åœ¨ drone_worker ä¸­æ·»åŠ 
start = get_tick_count()
# ... å·¥ä½œå¾ªç¯ ...
elapsed = get_tick_count() - start
data["stats"]["region_" + str(region_id) + "_time"] = elapsed

# åœ¨ä¸»å¾ªç¯ä¸­æ˜¾ç¤º
if cycle_count % 10 == 0:
    for i in range(num_regions):
        time = shared["stats"].get("region_" + str(i) + "_time", 0)
        quick_print("åŒºåŸŸ" + str(i) + ": " + str(time) + " ticks")
```

## æ€»ç»“

æŒä¹…åŒ–æ— äººæœºæ± æ¶æ„æ˜¯å¤šæ— äººæœºç³»ç»Ÿçš„**ç»ˆæä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

- ğŸš€ **æ€§èƒ½æå‡**ï¼šé•¿æœŸè¿è¡Œæ•ˆç‡æå‡ 50-100 å€
- âš¡ **é›¶åœæœº**ï¼šæ— äººæœºæŒç»­å·¥ä½œï¼Œæ— æµªè´¹æ—¶é—´
- ğŸ¯ **åŠ¨æ€å“åº”**ï¼šå®æ—¶è°ƒæ•´ç­–ç•¥ï¼Œæ— éœ€é‡å¯
- ğŸ”„ **çœŸæ­£å¹¶è¡Œ**ï¼šä¸»æœºå’Œæ‰€æœ‰æ— äººæœºåŒæ—¶å·¥ä½œ
- ğŸ“Š **å®æ—¶ç›‘æ§**ï¼šéšæ—¶æŸ¥è¯¢è¿›åº¦å’Œç»Ÿè®¡
- ğŸ›¡ï¸ **å†…å­˜å®‰å…¨**ï¼šé¿å…ç«æ€æ¡ä»¶ï¼Œç¨³å®šå¯é 

**è¿™æ˜¯ TFWR å¤šæ— äººæœºç¼–ç¨‹çš„æœ€ä½³å®è·µï¼**

