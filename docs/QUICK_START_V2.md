# Resource Farm Mega V2 快速入门

## 🚀 一分钟了解

**V2 采用持久化无人机池架构：**
- ✅ 无人机只创建一次，持续运行
- ✅ 自动响应优先级变化
- ✅ 长期运行效率提升 **10-100 倍**
- ✅ 真正的并行执行

## 📋 运行前提

### 必需解锁
- ✅ `Unlocks.Megafarm` - 多无人机支持
- ✅ `Unlocks.Loops` - 循环
- ✅ `Unlocks.Functions` - 函数
- ✅ `Unlocks.Operators` - 运算符

### 推荐解锁
- ⭐ `Unlocks.Speed` - 速度提升（多次）
- ⭐ `Unlocks.Expand` - 农场扩展到 16×16
- ⭐ `Unlocks.Polyculture` - 伴生种植增产
- ⭐ `Unlocks.Watering` - 浇水加速

## 🎮 使用方法

### 步骤 1：复制脚本
将 `resource_farm_mega.py` 的内容复制到游戏的代码编辑器

### 步骤 2：运行
点击"运行"按钮，脚本会：
1. 创建共享数据
2. 计算区域划分
3. 启动所有无人机（一次性）
4. 进入轻量级监控循环

### 步骤 3：观察
```
=== 持久化多无人机农场 V2 ===
农场大小：16x16
最大无人机：16

=== 启动无人机池 ===
区域数：16
最大无人机：16
区域0: 无人机已启动
区域1: 无人机已启动
...
成功启动 15 个持久无人机

=== 资源 ===
干:1000/1000000000
木:500/500000000
萝:250/500000000
优先级: 草
```

### 步骤 4：等待
无人机会自动：
- 持续收割和种植
- 根据资源比例调整优先级
- 处理伴生种植需求
- 自动浇水（如有水资源）

## 📊 输出说明

### 启动阶段
```
=== 启动无人机池 ===
区域数：16              # 农场被分成 16 个区域
最大无人机：16          # 最多可用 16 个无人机
区域0: 无人机已启动     # 每个区域分配一个无人机
...
成功启动 15 个持久无人机  # 实际启动数量（主机也算一个）
```

### 运行阶段
```
=== 资源 ===
干:50000/1000000000     # 干草：当前/目标
木:25000/500000000      # 木材：当前/目标
萝:12000/500000000      # 胡萝卜：当前/目标
优先级: 草               # 当前种植优先级
```

### 统计输出（每 5 个循环）
```
统计 - 收:4256 树:80 萝:120 草:4056
       ↑      ↑    ↑      ↑
       收割   树   胡萝卜  草
```

## ⚙️ 配置选项

### 调整资源目标
编辑脚本顶部：
```python
TARGETS = {
    Items.Hay: 1000000000,    # 10 亿干草
    Items.Wood: 500000000,    # 5 亿木材
    Items.Carrot: 500000000   # 5 亿胡萝卜
}
```

### 调整统计频率
```python
# 在主循环中
if cycle_count % 5 == 0:  # 每 5 个循环显示
    # 改为 % 10 = 每 10 个循环
    # 改为 % 1 = 每个循环都显示
```

### 调整等待时间
```python
# 在主循环中
for i in range(10):  # 等待 10 次 do_a_flip
    do_a_flip()
# 改为 range(5) = 更频繁检查
# 改为 range(20) = 更长等待
```

## 🎯 优先级系统

### 自动优先级算法
```python
# 比较相对进度
hay_progress = hay / 1000000000
wood_progress = wood / 500000000
carrot_progress = carrot / 500000000

# 优先种植进度最慢的
if hay_progress < wood_progress and hay_progress < carrot_progress:
    priority = "草"
elif wood_progress < carrot_progress:
    priority = "树"
else:
    priority = "胡萝卜"
```

### 种植分布

**草优先时：**
- 草：67%
- 树：11%（棋盘格）
- 胡萝卜：22%

**树优先时：**
- 草：25%
- 树：25%（密集棋盘格）
- 胡萝卜：50%

**胡萝卜优先时：**
- 草：25%
- 树：11%
- 胡萝卜：64%

## 🔧 故障排除

### 问题：无人机没启动
**症状：**
```
区域0: 无法生成（达到上限）
成功启动 0 个持久无人机
```

**原因：** 没解锁 `Unlocks.Megafarm` 或已有其他无人机运行

**解决：**
1. 解锁 Megafarm
2. 停止其他正在运行的无人机脚本

### 问题：无人机数量少于预期
**症状：**
```
区域数：16
成功启动 3 个持久无人机  # 少于 15
```

**原因：** Megafarm 等级不够高

**解决：** 继续升级 `Unlocks.Megafarm` 增加无人机上限

### 问题：优先级不变化
**症状：** 一直显示"优先级: 草"

**原因：** 资源比例还未达到切换条件

**解决：** 等待资源积累，系统会自动切换优先级

### 问题：伴生种植不生效
**症状：** 没有看到增产效果

**原因：** 
1. 未解锁 `Unlocks.Polyculture`
2. 伴生需求还未生成

**解决：**
1. 解锁 Polyculture
2. 多运行几个循环，伴生地图会逐渐填充

## 📈 性能优化建议

### 1. 扩展农场
```python
# 大农场更能发挥多无人机优势
# 推荐：16×16 或更大
```

### 2. 升级速度
```python
# 每次升级速度都会翻倍
# 优先升级 Unlocks.Speed
```

### 3. 获取能量
```python
# 运行 sunflower_farm_mega.py 收集能量
# 能量会让所有操作 2× 速度
```

### 4. 使用浇水
```python
# 水会加速生长（最高 5× 速度）
# 升级 Unlocks.Watering 获取更多水
```

## 🔍 监控和调试

### 查看详细统计
在主循环中添加：
```python
# 每个循环显示所有区域
for i in range(15):
    key = "region_" + str(i)
    if key in shared["stats"]:
        stats = shared["stats"][key]
        quick_print("区域" + str(i) + ": " + str(stats))
```

### 查看伴生地图
```python
# 显示伴生需求数量
comp_count = len(shared["companion_map"])
quick_print("伴生需求: " + str(comp_count))
```

### 性能分析
```python
# 在主循环开始添加
start = get_tick_count()

# 在主循环结束添加
elapsed = get_tick_count() - start
quick_print("循环耗时: " + str(elapsed) + " ticks")
```

## 💡 高级技巧

### 技巧 1：优先级锁定
```python
# 锁定在特定优先级
shared["priority"] = 0  # 强制草优先
# 注释掉 main_loop() 中的更新代码
```

### 技巧 2：区域重新分配
```python
# 如果后期无人机增多，重启脚本
# 会自动重新计算区域划分
```

### 技巧 3：手动停止
```python
# 在代码中添加停止条件
if num_items(Items.Hay) >= TARGETS[Items.Hay]:
    shared["should_stop"] = True
    break  # 停止主循环
```

## 🎓 学习资源

### 相关文档
- `PERSISTENT_DRONE_POOL.md` - 持久化架构详解
- `V1_VS_V2_COMPARISON.md` - V1 与 V2 对比
- `RESOURCE_FARM_OPTIMIZATION.md` - 优化技术说明
- `DRONE_SHARED_MEMORY_DISCOVERY.md` - 共享内存原理

### 实验建议
1. 先在小农场（4×4）测试
2. 观察无人机启动过程
3. 监控优先级变化
4. 查看资源增长
5. 扩展到大农场（16×16）

## 📝 注意事项

### ⚠️ 重要
1. **只运行一次** - 不要重复启动脚本（无人机会累积）
2. **停止方法** - 按游戏的"停止"按钮（不是暂停）
3. **内存使用** - V2 使用共享内存，正常现象
4. **启动耗时** - 创建 15 个无人机需要 ~3000 ticks

### ✅ 正常现象
- 启动阶段稍慢（创建无人机）
- 主循环非常快（只更新配置）
- 无人机持续工作（看不到等待）
- 资源持续增长（24/7 运行）

## 🏆 预期效果

### 短期（1-10 分钟）
- 无人机全部启动
- 开始收集资源
- 优先级自动调整
- 伴生地图填充

### 中期（10-60 分钟）
- 资源稳定增长
- 优先级动态平衡
- 伴生种植生效
- 产量显著提升

### 长期（1+ 小时）
- 接近资源目标
- V2 效率优势明显
- 节省数十万 ticks
- 远超 V1 性能

## 🎉 总结

**V2 持久化架构让你：**
- 🚀 最大化多无人机效率
- ⚡ 持续运行不间断
- 🎯 自动平衡资源收集
- 📊 实时监控进度
- 🔧 易于配置和扩展

**开始使用，体验 10-100 倍的性能提升！** 🚀✨

